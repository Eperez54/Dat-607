---
title: "Project 2"
author: "Eddie Perez"
date: '2022-03-4'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Libraries Used in Project #2

```{r, warning=FALSE, comment=FALSE, results=FALSE, message=FALSE}
library(dplyr)
library(stringr)
library(tidyr)
library(knitr)
library(kableExtra)
library(ggplot2)


```

# Dataset #1 - Pokemon Dataset
### Comparing two different types of pokemon 

Found a useful pokemon dataset here -> https://gist.githubusercontent.com/armgilles/194bcff35001e7eb53a2a8b441e8b2c6/raw/92200bc0a673d5ce2110aaad4544ed6c4010f687/pokemon.csv 

I will save this in my own github and use it from there.

I decided to work on this dataset because I recently started playing Pokemon Shield on my Nintendo Switch and am on a mission to capture all to fill my pokedex (a dictionary with useful pokemon stats). This cause my interest in search for such data since it is in the game it must be in the internet.

### Reading the data from csv into R

```{r}
#pokemon_data <- read.csv('https://gist.githubusercontent.com/armgilles/194bcff35001e7eb53a2a8b441e8b2c6/raw/92200bc0a673d5ce2110aaad4544ed6c4010f687/pokemon.csv')

pokemon_data <- read.csv('https://raw.githubusercontent.com/Eperez54/Dat-607/main/Project%202/pokemon.csv')
head(pokemon_data, 25)
```
Some Pokemon were duplicated -- mostly those that were split into multiple Mega versions of themselves. To remove these, I wil use regular expression.


```{r}

pokemon_data <- pokemon_data %>% 
  filter(!str_detect(Name, '\\Mega'))

head(pokemon_data, 15)
```
By comparing both data frames we can indeed see that the mega Pokemon were removed

For this comparison, it would be useful to select the columns that are relevant, and to group them by their type and total HP. In order to calculate maximum and minimum HP per Pokemon type, I used group by multiple times as well as mutate a few times.  


```{r}

lowandHighHp <- pokemon_data %>% 
  select(X.,Name, Type.1, Total) %>% 
    arrange(Type.1, Total) %>% 
    group_by(Type.1) %>% 
      mutate(High_HP = max(Total), Low_HP = min(Total)) %>% 
    ungroup() %>% mutate(HP_Stats = (Total == High_HP) | (Total == Low_HP)) %>% 
      filter(HP_Stats == TRUE) %>% 
      mutate(HP_Stats = ifelse(Total == High_HP, 'High HP', 'Low HP')) %>%
        select(X.,Name, Type.1, HP_Stats, Total) %>%
          arrange(desc(Total)) %>%
           rename("Pokemon #" = X.,  "Type" = Type.1, "Pokemon" = Name, "Total HP" = Total)

highestHp <- lowandHighHp %>% filter(HP_Stats == 'High HP')

lowestHp <- lowandHighHp %>% filter(HP_Stats == 'Low HP')

highestHp
lowestHp

```


### Printing the tables using shiny

```{r}
kable(highestHp, align = 'clc', caption = 'Pokemon w/ Highest HP in Group') %>%
    kable_styling(bootstrap_options = c('striped'), full_width = F)

kable(lowestHp, align = 'clc', caption = 'Pokemon w/ Lowest HP in Group') %>%
    kable_styling(bootstrap_options = c('striped'), full_width = F)

```

Those Pokemon that have the highest HP for their group are evolved forms of less evolved Pokemon, as we can see from the list above. Similarly, Pokemon with the lowest HP for their group tend to be non evolved forms. The goal as a trainer in the game is to increase your Pokemon's hit points (HP), as well as evolve them to be more effective against other Pokemon you do this by doing battle with wild Pokemon or fighting against other trainers.For the purpose of answering this question, we will compare Water type Pokemon to Grass type Pokemon.

```{r}

filter_pokemon_type <- lowandHighHp %>% filter(Type == 'Grass' | Type == 'Water') %>% 
      arrange(`Total HP`)

plot <- ggplot(filter_pokemon_type, aes(x = Pokemon, y = `Total HP`, fill= HP_Stats))
plot <- plot + scale_y_continuous()
plot <- plot + theme(legend.position = "right")

plot <- plot + geom_bar(stat = "identity", position = "stack", color="black")
plot <- plot + facet_wrap(Type ~ ., scales = "free_x")
plot
``` 
### Conclusion 
 
When we compare the Pokemon that have the highest and lowest hit points from the Grass and Water types, we can see that Sukern has a lower hit point total than Feebas or Magikarp, which is the lowest hit point total for a Water type. Also, KyogrePrimal Kyogre has a higher HP than ShayminLand Forme and ShayminSky Forme (same number), who has the highest HP of all Grass type Pokemon. Consequently, when we compare the Pokemon with the highest and lowest HP between Water type and Grass type, we see that water types have a higher HP for both their lowest and highest rated Pokemon compared to Grass type Pokemon.

# Dataset 2: Lending Club Accepted Loans from 2007 - 2018
https://www.kaggle.com/wordsforthewise/lending-club?select=accepted_2007_to_2018Q4.csv.gz

Question: is there a direct relationship between these fields (interest rates, grade, loan amount and income)?

```{r}
loan <- read.csv("M:/607/archive/accepted2018Q4.csv")

# summary(loan) too long 

```

```{r}
colnames(loan)
```
## Selection of fields I need

```{r}
loan <- loan %>% 
    select(annual_inc, loan_amnt, int_rate, grade) 
colnames(loan)
head(loan)
```
It will be easier for me to create a field and categorize the loan, interest rates and the customer annual salary

```{r}
#loan amount group
loan$loangroup <- findInterval(loan$loan_amnt, seq(0, 30000, 10000)) 
loan$loangroup[loan$loangroup==1] <- "<$10,000"
loan$loangroup[loan$loangroup==2] <- "<$20,000"
loan$loangroup[loan$loangroup==3] <- "<$30,000"
loan$loangroup[loan$loangroup==4] <- "<=$40,000"

loan$loangroup <- factor(loan$loangroup, levels=c("<$10,000", "<$20,000", "<$30,000", "<=$40,000"))

#Loan interest rates group also know as APR
loan$aprgroup<- findInterval(loan$int_rate, seq(0, 30, 10))
loan$aprgroup[loan$aprgroup==1] <- "0-10%"
loan$aprgroup[loan$aprgroup==2] <- "10-20%"
loan$aprgroup[loan$aprgroup==3] <- "20-30%"
loan$aprgroup[loan$aprgroup==4] <- "30-40%"

loan$aprgroup<- factor(loan$aprgroup, levels=c("0-10%", "10-20%", "20-30%", "30-40%"))

# Grouping customer annual salary by every $25k
loan$salarygroup <- findInterval(loan$annual_inc, seq(0, 100000, 25000))
loan$salarygroup[loan$salarygroup==1] <- "<$25,000"
loan$salarygroup[loan$salarygroup==2] <- "<$50,000"
loan$salarygroup[loan$salarygroup==3] <- "<$75,000"
loan$salarygroup[loan$salarygroup==4] <- "<$100,000"
loan$salarygroup[loan$salarygroup==5] <- ">=$100,000"

loan$salarygroup <- factor(loan$salarygroup, levels=c("<$25,000"," <$50,000", "<$75,000",
                                                      "<$100,000", ">=$100,000"))

tail(loan)

```


